## 整个工程文件说明

工程目录解析:

- 文法.txt：实现的CFG语法以及简单描述。具体描述可见于实验报告。

- hpp文件：

  - **util.hpp**：词法分析、语法分析部分的头文件，定义了词法语法分析中的类、枚举常量，声明分析方法。
  - **ParExp1.hpp**：声明了语法分析类到中间代码生成的接口以及用于语义分析的全局变量。
  - **codegen1.hpp**：代码生成部分头文件，声明了和语言结构相关的众多类以及用于**LLVM**生成中间代码的全局变量和方法。

- cpp文件：

  - **token.cpp**：使用DFA进行词法分析。
  - **praser.cpp**：递归下降的进行CFG解析、语法分析，使用LL(1)算法。
  - **ParExp1.cpp**：定义了语法分析生成的AST到后续设计的类之间的接口，并且进行语义分析（符号表+类型检查）。
  - **codegen1.cpp**：基于**LLVM**实现了众多类的代码生成函数。main函数在这个文件中，进行DFA构造、token读取、语法树生成、语义分析、转换为新定义类的语法树、中间代码生成、（中间代码优化）所有过程的函数调用。
  - **codegen_opt.cpp**：在codegen1.cpp的基础上设计了优化模块代码以及嵌入其他函数的方法。

- **Makefile**：可以使用make来生成可执行文件，可执行文件有两种类型，Name类型为不带任何优化的版本，Name1类型为带有嵌入C函数，带有5个可选优化的版本（根据LLVM每个优化pass各自独立的设计，优化类型可以任意组合）；你可以通过编辑Name的值指定生成文件的名字，请勿同时在多个线程执行make命令。（相关内容已经下载Makefile中）

- **input**：input文件为默认的自定义语法的输入文件（即一种CFG文法的推导结果），程序将读取文件并且检查错误，无错误则生成中间代码。

- inputrecord：一些input可选的内容以及历史记录。

- **可执行文件**：

  - final_ori11：未带优化的可执行文件，以input文件为输入，输出中间代码或者输出错误信息到终端。
  - final_optwithC11：带优化的可执行文件（勾选了实验中4.1 4.2 4.3的优化，其他优化可以通过打开注释重新make），嵌入`printi(__int16_t)`函数声明打印整数，其他同上，具体请参看实验报告第5章。

- test文件夹

  - testn：实验报告中第n个测试样例的代码。
  - testn_ori：testn中的代码放入input文件，执行final_ori11输出的中间代码。
  - testn_opt：testn中的代码放入input文件，执行final_optwithC11输出的优化过的中间代码。
  
- 其他文件

  - printi.c：定义了printi函数，使用编译命令

    ```bash
    clang -S -emit-llvm printi.c -o printi.ll
    ```

    生成可读LLVM字节码文件printi.ll，后续可与本程序执行生成的中间代码共同编译生成可执行文件。（该文件完全是为了嵌入打印功能）

    ```bash
    clang printi.ll output.ll -o output
    ```

    生成的output可以执行并且进行打印。



#### 操作方法再次讲解：

make执行得到可执行程序，编辑input内容为你想测试的输入内容，执行程序可以得到结果（报错或者无错误情况下生成中间代码（优化or未优化））。拷贝终端输出的部分

```asm
; ModuleID = '666 compiling principal PYF YHR'
source_filename = "666 compiling principal PYF YHR"
```

从这行开始拷贝到结束，然后放入到一个空的.ll文件中。

之后按照上述方式运行或者按照报告中指定的方式进行运行即可。

由于使用了LLVM成熟的架构，生成的中间代码完全可以继续生成目标代码，理论和实践都是支持的。



整个工程没有建立新的文件夹，方便读者直接执行，避免读者可能的错误。可执行文件可以参照实验报告第5张的内容生成。




<p align=right>——庞懿非
